<!doctype html>
<html lang="en" data-bs-theme="auto">

<head>
  <script src="js/bootstrap-5.3.0/color-modes.js"></script>
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="ElDuderino">
  <meta name="generator" content="">
  <title>IoT Cloud UI Template</title>

  <link rel="canonical" href="">
  <!--font-awesome-->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">

  <link href="js/bootstrap-5.3.0/dist/css/bootstrap.css" rel="stylesheet">
  <link href="js/DataTables/datatables.css" rel="stylesheet">
  <link href="js/apexcharts/dist/apexcharts.css" rel="stylesheet">

  <style>
    .bd-placeholder-img {
      font-size: 1.125rem;
      text-anchor: middle;
      -webkit-user-select: none;
      -moz-user-select: none;
      user-select: none;
    }

    @media (min-width: 768px) {
      .bd-placeholder-img-lg {
        font-size: 3.5rem;
      }
    }

    .b-example-divider {
      width: 100%;
      height: 3rem;
      background-color: rgba(0, 0, 0, .1);
      border: solid rgba(0, 0, 0, .15);
      border-width: 1px 0;
      box-shadow: inset 0 .5em 1.5em rgba(0, 0, 0, .1), inset 0 .125em .5em rgba(0, 0, 0, .15);
    }

    .b-example-vr {
      flex-shrink: 0;
      width: 1.5rem;
      height: 100vh;
    }

    .bi {
      vertical-align: -.125em;
      fill: currentColor;
    }

    .nav-scroller {
      position: relative;
      z-index: 2;
      height: 2.75rem;
      overflow-y: hidden;
    }

    .nav-scroller .nav {
      display: flex;
      flex-wrap: nowrap;
      padding-bottom: 1rem;
      margin-top: -1px;
      overflow-x: auto;
      text-align: center;
      white-space: nowrap;
      -webkit-overflow-scrolling: touch;
    }

    .btn-bd-primary {
      --bd-violet-bg: #712cf9;
      --bd-violet-rgb: 112.520718, 44.062154, 249.437846;

      --bs-btn-font-weight: 600;
      --bs-btn-color: var(--bs-white);
      --bs-btn-bg: var(--bd-violet-bg);
      --bs-btn-border-color: var(--bd-violet-bg);
      --bs-btn-hover-color: var(--bs-white);
      --bs-btn-hover-bg: #6528e0;
      --bs-btn-hover-border-color: #6528e0;
      --bs-btn-focus-shadow-rgb: var(--bd-violet-rgb);
      --bs-btn-active-color: var(--bs-btn-hover-color);
      --bs-btn-active-bg: #5a23c8;
      --bs-btn-active-border-color: #5a23c8;
    }

    .bd-mode-toggle {
      z-index: 1500;
    }

    .loader {
      width: 48px;
      height: 48px;
      border: 3px solid #FFF;
      border-radius: 50%;
      display: inline-block;
      position: relative;
      box-sizing: border-box;
      animation: rotation 1s linear infinite;
    }

    .loader::after {
      content: '';
      box-sizing: border-box;
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 56px;
      height: 56px;
      border-radius: 50%;
      border: 3px solid transparent;
      border-bottom-color: #FF3D00;
    }

    @keyframes rotation {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    #table-live-sensor-data .info-div {
      text-align: center;
    }

    #modalChart .modal-subheader span {
      display: inline-flexbox;
      font-weight: bold;
      font-size: 110%;
    }
  </style>


  <!-- Custom styles for this template -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css" rel="stylesheet">
  <!-- Custom styles for this template -->
  <link href="dashboard.css" rel="stylesheet">
</head>

<body>
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
    <symbol id="check2" viewBox="0 0 16 16">
      <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" />
    </symbol>
    <symbol id="circle-half" viewBox="0 0 16 16">
      <path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z" />
    </symbol>
    <symbol id="moon-stars-fill" viewBox="0 0 16 16">
      <path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z" />
      <path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z" />
    </symbol>
    <symbol id="sun-fill" viewBox="0 0 16 16">
      <path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z" />
    </symbol>
  </svg>

  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
    <symbol id="calendar3" viewBox="0 0 16 16">
      <path d="M14 0H2a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zM1 3.857C1 3.384 1.448 3 2 3h12c.552 0 1 .384 1 .857v10.286c0 .473-.448.857-1 .857H2c-.552 0-1-.384-1-.857V3.857z" />
      <path d="M6.5 7a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm-9 3a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm-9 3a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2z" />
    </symbol>
    <symbol id="chevron-right" viewBox="0 0 16 16">
      <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z" />
    </symbol>
    <symbol id="door-closed" viewBox="0 0 16 16">
      <path d="M3 2a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v13h1.5a.5.5 0 0 1 0 1h-13a.5.5 0 0 1 0-1H3V2zm1 13h8V2H4v13z" />
      <path d="M9 9a1 1 0 1 0 2 0 1 1 0 0 0-2 0z" />
    </symbol>
    <symbol id="file-earmark" viewBox="0 0 16 16">
      <path d="M14 4.5V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h5.5L14 4.5zm-3 0A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4.5h-2z" />
    </symbol>
    <symbol id="file-earmark-text" viewBox="0 0 16 16">
      <path d="M5.5 7a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1h-5zM5 9.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5z" />
      <path d="M9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.5L9.5 0zm0 1v2A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z" />
    </symbol>
    <symbol id="gear-wide-connected" viewBox="0 0 16 16">
      <path d="M7.068.727c.243-.97 1.62-.97 1.864 0l.071.286a.96.96 0 0 0 1.622.434l.205-.211c.695-.719 1.888-.03 1.613.931l-.08.284a.96.96 0 0 0 1.187 1.187l.283-.081c.96-.275 1.65.918.931 1.613l-.211.205a.96.96 0 0 0 .434 1.622l.286.071c.97.243.97 1.62 0 1.864l-.286.071a.96.96 0 0 0-.434 1.622l.211.205c.719.695.03 1.888-.931 1.613l-.284-.08a.96.96 0 0 0-1.187 1.187l.081.283c.275.96-.918 1.65-1.613.931l-.205-.211a.96.96 0 0 0-1.622.434l-.071.286c-.243.97-1.62.97-1.864 0l-.071-.286a.96.96 0 0 0-1.622-.434l-.205.211c-.695.719-1.888.03-1.613-.931l.08-.284a.96.96 0 0 0-1.186-1.187l-.284.081c-.96.275-1.65-.918-.931-1.613l.211-.205a.96.96 0 0 0-.434-1.622l-.286-.071c-.97-.243-.97-1.62 0-1.864l.286-.071a.96.96 0 0 0 .434-1.622l-.211-.205c-.719-.695-.03-1.888.931-1.613l.284.08a.96.96 0 0 0 1.187-1.186l-.081-.284c-.275-.96.918-1.65 1.613-.931l.205.211a.96.96 0 0 0 1.622-.434l.071-.286zM12.973 8.5H8.25l-2.834 3.779A4.998 4.998 0 0 0 12.973 8.5zm0-1a4.998 4.998 0 0 0-7.557-3.779l2.834 3.78h4.723zM5.048 3.967c-.03.021-.058.043-.087.065l.087-.065zm-.431.355A4.984 4.984 0 0 0 3.002 8c0 1.455.622 2.765 1.615 3.678L7.375 8 4.617 4.322zm.344 7.646.087.065-.087-.065z" />
    </symbol>
    <symbol id="graph-up" viewBox="0 0 16 16">
      <path fill-rule="evenodd" d="M0 0h1v15h15v1H0V0Zm14.817 3.113a.5.5 0 0 1 .07.704l-4.5 5.5a.5.5 0 0 1-.74.037L7.06 6.767l-3.656 5.027a.5.5 0 0 1-.808-.588l4-5.5a.5.5 0 0 1 .758-.06l2.609 2.61 4.15-5.073a.5.5 0 0 1 .704-.07Z" />
    </symbol>
    <symbol id="house-fill" viewBox="0 0 16 16">
      <path d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L8 2.207l6.646 6.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293L8.707 1.5Z" />
      <path d="m8 3.293 6 6V13.5a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 2 13.5V9.293l6-6Z" />
    </symbol>
    <symbol id="list" viewBox="0 0 16 16">
      <path fill-rule="evenodd" d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z" />
    </symbol>
    <symbol id="people" viewBox="0 0 16 16">
      <path d="M15 14s1 0 1-1-1-4-5-4-5 3-5 4 1 1 1 1h8Zm-7.978-1A.261.261 0 0 1 7 12.996c.001-.264.167-1.03.76-1.72C8.312 10.629 9.282 10 11 10c1.717 0 2.687.63 3.24 1.276.593.69.758 1.457.76 1.72l-.008.002a.274.274 0 0 1-.014.002H7.022ZM11 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4Zm3-2a3 3 0 1 1-6 0 3 3 0 0 1 6 0ZM6.936 9.28a5.88 5.88 0 0 0-1.23-.247A7.35 7.35 0 0 0 5 9c-4 0-5 3-5 4 0 .667.333 1 1 1h4.216A2.238 2.238 0 0 1 5 13c0-1.01.377-2.042 1.09-2.904.243-.294.526-.569.846-.816ZM4.92 10A5.493 5.493 0 0 0 4 13H1c0-.26.164-1.03.76-1.724.545-.636 1.492-1.256 3.16-1.275ZM1.5 5.5a3 3 0 1 1 6 0 3 3 0 0 1-6 0Zm3-2a2 2 0 1 0 0 4 2 2 0 0 0 0-4Z" />
    </symbol>
    <symbol id="plus-circle" viewBox="0 0 16 16">
      <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
      <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z" />
    </symbol>
    <symbol id="search" viewBox="0 0 16 16">
      <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z" />
    </symbol>
  </svg>

  <div class="dropdown position-fixed bottom-0 end-0 mb-3 me-3 bd-mode-toggle">
    <button class="btn btn-bd-primary py-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" aria-label="Toggle theme (auto)">
      <svg class="bi my-1 theme-icon-active" width="1em" height="1em">
        <use href="#circle-half"></use>
      </svg>
      <span class="visually-hidden" id="bd-theme-text">Toggle theme</span>
    </button>
    <ul class="dropdown-menu dropdown-menu-end shadow" aria-labelledby="bd-theme-text">
      <li>
        <button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
          <svg class="bi me-2 opacity-50 theme-icon" width="1em" height="1em">
            <use href="#sun-fill"></use>
          </svg>
          Light
          <svg class="bi ms-auto d-none" width="1em" height="1em">
            <use href="#check2"></use>
          </svg>
        </button>
      </li>
      <li>
        <button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
          <svg class="bi me-2 opacity-50 theme-icon" width="1em" height="1em">
            <use href="#moon-stars-fill"></use>
          </svg>
          Dark
          <svg class="bi ms-auto d-none" width="1em" height="1em">
            <use href="#check2"></use>
          </svg>
        </button>
      </li>
      <li>
        <button type="button" class="dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
          <svg class="bi me-2 opacity-50 theme-icon" width="1em" height="1em">
            <use href="#circle-half"></use>
          </svg>
          Auto
          <svg class="bi ms-auto d-none" width="1em" height="1em">
            <use href="#check2"></use>
          </svg>
        </button>
      </li>
    </ul>
  </div>

  <header class="navbar sticky-top bg-dark flex-md-nowrap p-0 shadow" data-bs-theme="dark">
    <a class="navbar-brand col-md-3 col-lg-2 me-0 px-3 fs-6 text-white" href="#">Company name</a>

    <ul class="navbar-nav flex-row d-md-none">
      <li class="nav-item text-nowrap">
        <button class="nav-link px-3 text-white" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSearch" aria-controls="navbarSearch" aria-expanded="false" aria-label="Toggle search">
          <svg class="bi">
            <use xlink:href="#search" />
          </svg>
        </button>
      </li>
      <li class="nav-item text-nowrap">
        <button class="nav-link px-3 text-white" type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">
          <svg class="bi">
            <use xlink:href="#list" />
          </svg>
        </button>
      </li>
    </ul>

    <div id="navbarSearch" class="navbar-search w-100 collapse">
      <input class="form-control w-100 rounded-0 border-0" type="text" placeholder="Search" aria-label="Search">
    </div>
  </header>

  <div class="container-fluid">
    <div class="row">
      <div class="sidebar border border-right col-md-3 col-lg-2 p-0 bg-body-tertiary">
        <div class="offcanvas-lg offcanvas-end bg-body-tertiary" tabindex="-1" id="sidebarMenu" aria-labelledby="sidebarMenuLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="sidebarMenuLabel">Company name</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#sidebarMenu" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body d-md-flex flex-column p-0 pt-lg-3 overflow-y-auto">
            <ul class="nav flex-column">
              <li class="nav-item">
                <a class="nav-link d-flex align-items-center gap-2 active" aria-current="page" href="#">
                  <svg class="bi">
                    <use xlink:href="#house-fill" />
                  </svg>
                  Dashboard
                </a>
              </li>
            </ul>

            <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-body-secondary text-uppercase">
              <span>Menu Example</span>
              <a class="link-secondary" href="#" aria-label="Add a new report">
                <svg class="bi">
                  <use xlink:href="#plus-circle" />
                </svg>
              </a>
            </h6>
            <ul class="nav flex-column mb-auto">
              <li class="nav-item">
                <a class="nav-link d-flex align-items-center gap-2" href="#">
                  <svg class="bi">
                    <use xlink:href="#file-earmark-text" />
                  </svg>
                  Sample Link
                </a>
              </li>
            </ul>

            <hr class="my-3">

            <ul class="nav flex-column mb-auto">
              <li class="nav-item">
                <a class="nav-link d-flex align-items-center gap-2" href="#">
                  <svg class="bi">
                    <use xlink:href="#gear-wide-connected" />
                  </svg>
                  Settings
                </a>
              </li>
              <li class="nav-item">
                <a id="btn-logout" class="nav-link d-flex align-items-center gap-2" href="#">
                  <svg class="bi">
                    <use xlink:href="#door-closed" />
                  </svg>
                  Sign out
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
          <h1 class="h2">Dashboard</h1>
          <div class="btn-toolbar mb-2 mb-md-0">
            <div class="btn-group me-2">
              <button type="button" class="btn btn-sm btn-outline-secondary">Share</button>
              <button type="button" class="btn btn-sm btn-outline-secondary">Export</button>
            </div>
            <button type="button" class="btn btn-sm btn-outline-secondary dropdown-toggle d-flex align-items-center gap-1">
              <svg class="bi">
                <use xlink:href="#calendar3" />
              </svg>
              This week
            </button>
          </div>
        </div>
        <!-- table and charts here -->
        <!--controls-->
        <div id="main-sensor-container-controls" class="mb-2" style="font-size:85%">
          <div class="form-inline">
            <div class="form-group p-1 mr-3">
              <label for="type-select" class="col-form-label mr-2">Filter by Type:</label>
              <select class="form-control form-control-sm" id="type-select" data-style="btn-primary">

              </select>
            </div>
            <div class="form-group form-check-inline">
              <label class="form-check-label" for="chk-auto-update"> Auto update:</label><input class="mb-0 ml-2" type="checkbox" id="chk-auto-update" checked>
            </div>

          </div>

        </div>

        <div class="container p-3 dashboard-stats-container">
          <h4>Data from all live sensors:</h4>
          <div id="main-stats-container" class="container">

            <div class="clearfix"></div>
            <div id="table-container" class="table-responsive">
              <table id="table-live-sensor-data" width="100%"></table>
            </div>

          </div>
        </div>
        <!-- /table and charts -->
      </main>
    </div>
  </div>

  <div w3-include-html="modals/login-include.html"></div>
  <div w3-include-html="modals/modalFullChart.html"></div>

  <script src="js/jquery-3.7.0.js"></script>
  <script src="js/jquery-ui-1.13.2/jquery-ui.js"></script>
  <script src="js/bootstrap-5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="js/js.cookie.js"></script>
  <script src="js/bootbox.js"></script>
  <script src="js/DataTables/datatables.js"></script>
  <script src="js/apexcharts/dist/apexcharts.js"></script>
  <script src="js/moment.js"></script>
  <script src="js/turf.min.js"></script>
  <script src="js/sidebars.js"></script>
  <script src="js/aretas/AretasGlobalInit.js"></script>
  <script src="js/aretas/aretas-commons.js"></script>
  <script>
    var querySensorDataTimeoutRef = null;
    var lastSelected = null;
    var lastSensorData = null;
    let AAI;
    let FCPopup;

    $(document).ready(() => {
      docReady();
    });

    async function docReady() {

      console.log("INIT");

      AAI = await aretas_init();

      FCPopup = new FullChartPopup(AAI, document.getElementById('modalChart'));

      queryCacheData();

      $('#type-select').change(() => {
        lastSelected = $('#type-select :selected').val();
        console.log(`Last selected: ${lastSelected}`);
        updateSensorStatusTable(lastSensorData);
      });

      $('#chk-auto-update').change(() => {
        let enable_timer = $('#chk-auto-update').is(":checked");
        if (enable_timer) {
          clearTimer();
          queryTileData();
        } else {
          clearTimer();
        }
      });


    }

    function clearTimer() {
      if (querySensorDataTimeoutRef != null) {
        try {
          clearTimeout(querySensorDataTimeoutRef);
          querySensorDataTimeoutRef = null;
        } catch (error) {
          console.log("Couldn't clear timeout");
          console.log(error);
        }
      }
    }

    function queryCacheData() {

      console.log("Fetching data");

      enableInputs(false);

      let enable_timer = $('#chk-auto-update').is(":checked");

      //we should have a populated ClientLocationView
      //lets get the sensor reports
      $.ajax({
        beforeSend: function (xhr) {
          xhr.setRequestHeader('Authorization', "Bearer " + AAI.bearerToken);
        },
        dataType: "json",
        contentType: "application/json",
        type: "POST",
        url: ASNAPIURL + "sensorreport/latest",
        data: JSON.stringify(AAI.clientLocationView.allMacs),
        success: function (data) {
          //render the tiles
          lastSensorData = data;
          updateSensorStatusTable(lastSensorData, true);
          if (enable_timer) {
            querySensorDataTimeoutRef = setTimeout(queryCacheData, 30000);
          } else {
            clearTimer();
          }
        },
        error: function (err) {
          bootbox.alert("Couldn't load sensor status reports!");
          console.log("Error fetching sensorreports");
          console.log(err);
        },
        complete: function (status) {
          enableInputs(true);
        }

      });

    }

    /**
     * disable the inputs during loading to prevent requerying
     */
    function enableInputs(enableInput) {

      enableInput = !enableInput;
      document.getElementById('type-select').enabled = enableInput;
      document.getElementById('chk-auto-update').enabled = enableInput;

    }

    function filterTable() { }

    function constructDataTable() {

      console.log("Creating data table")

      let dataTbl = $('#table-live-sensor-data').DataTable({
        pageLength: "25",
        deferRender: true,
        stateSave: false,
        responsive: true,
        order: [3, "asc"],
        columns: [{
          title: "Location",
          render: (data, type) => {
            if (type === 'display') {

              let locSpan = document.createElement("span");
              locSpan.append(data.description);
              return locSpan.outerHTML;

            } else {
              return data.description;
            }
          }
        }, {
          title: "MAC",
          render: (data, type) => {

            if (type === 'display') {

              const sensorObj = data.sensorObj;
              const sensorDatum = data.sensorDatum;

              let dashIcon = document.createElement("i");
              dashIcon.setAttribute("class", "fas fa-chart-line me-2");

              let hrefA = document.createElement("a");

              hrefA.setAttribute("href", "#");
              hrefA.setAttribute("class", "");
              hrefA.setAttribute("alt", "Click for full chart");
              hrefA.setAttribute("title", "Click for full chart");
              hrefA.append(dashIcon, sensorDatum.mac);

              return hrefA.outerHTML;

            } else if (type === 'sort') {
              return parseInt(data);
            } else {
              return data;
            }
          }

        }, {
          title: "Description",
          render(data, type) {
            if (type === 'display') {

              let badge = document.createElement("span");
              badge.setAttribute("class", "");
              badge.append(data);
              return badge.outerHTML;

            } else if (type === 'sort') {
              return data;
            } else {
              return data;
            }
          }
        }, {
          title: "Timestamp",
          render: (data, type) => {

            if (type === 'display') {
              const timestamp = new moment(data.timestamp).format('MMMM Do YYYY, HH:mm');
              var tSpan = document.createElement("span");
              tSpan.setAttribute("class", "");
              tSpan.setAttribute("id", "timestamp-badge-for-" + data.mac);
              tSpan.append(timestamp);
              return tSpan.outerHTML;

            } else if (type === 'sort') {
              return parseInt(data.timestamp);
            } else {
              return parseInt(data.timestamp);
            }
          }

        }, {
          title: "Data",
          render: (data, type) => {

            if (type === 'display') {

              let zoneBgColor = AAI.getIconDivColor(parseInt(data.type), data.data);
              let div = document.createElement("div");
              div.setAttribute("class", "info-div");
              $(div).css("background-color", zoneBgColor);
              $(div).css("color", getContrastingFontColor(zoneBgColor));

              div.append(parseFloat(data.data).toFixed(1) + "" + AAI.getSensorTypeInfo(parseInt(data.type)).units);

              return div.outerHTML;

            } else {
              return data.data;
            }
          }
        }, {
          title: "Type",
          render: (data, type) => {
            if (type == 'display') {

              let spanNoWrap = document.createElement("span");
              spanNoWrap.setAttribute("class", "text-nowrap");

              let divIcon = document.createElement("div");
              divIcon.setAttribute("class", "sensortype-icon type-" + data.type);

              let sensorTypeInfo = AAI.getSensorTypeInfo(parseInt(data.type));
              let typeLabel = document.createElement("span");
              typeLabel.setAttribute("class", "");
              typeLabel.append(sensorTypeInfo.label);

              spanNoWrap.append(divIcon, typeLabel);
              return spanNoWrap.outerHTML;

            } else {
              return data.type;
            }
          }
        }],
        data: {},
        initComplete: function () {
          $(this.api().table().container()).find('input[type="search"]').parent().wrap('<form>').parent().attr('autocomplete', 'off').css('overflow', 'hidden').css('margin', 'auto');
        }
      });

      $('#table-live-sensor-data').on('click', 'td', function () {

        const dt = $('#table-live-sensor-data').DataTable();
        const data = dt.cell(this).data();
        console.log(data);
        const sensorDatum = data.sensorDatum;
        const sensorObj = data.sensorObj;
        FCPopup.showFullChart(sensorDatum.type, sensorObj.id);

      })

      console.log("Table constructed!");

      return dataTbl;
    }


    function updateSensorStatusTable(rawData, srcAjax = false) {

      console.log("Updating sensor data table...");

      let sensorData = rawData;

      if (lastSelected != null) {
        if (lastSelected !== "All Types") {
          sensorData = rawData.filter(sensorDatum => sensorDatum.type == lastSelected);
        }
      }

      let dataTbl;

      //check if we have already converted the table into a DataTable
      //if not, make one!
      if ($.fn.dataTable.isDataTable('#table-live-sensor-data') === false) {

        dataTbl = constructDataTable();

      }

      //get the reference if we don't already have one
      dataTbl = $('#table-live-sensor-data').DataTable();

      //remove any selected rows
      dataTbl.$('tr.selected').removeClass('selected');

      //the default error reporting is not user or developer friendly....
      $.fn.dataTable.ext.errMode = 'none';

      $('#table-live-sensor-data').on('error.dt', function (e, settings, techNote, message) {
        console.log('An error has been reported by DataTables: ', message);
      }).DataTable();

      console.log("Clearing data...");
      //clear the existing data
      dataTbl.clear().draw();

      console.log("Adding data...");

      let start = new Date().getTime();

      sensorData.forEach((sensorDatum, key) => {

        //console.log(areaEventLogItem);
        //get the sensor for this MAC
        let sensorObj = AAI.getSensorByMac(sensorDatum.mac);
        let locationObj = AAI.getLocationByID(sensorObj.owner);

        try {
          dataTbl.row.add(
            [{
              id: locationObj.id,
              description: locationObj.description
            },
            {
              sensorObj: sensorObj,
              sensorDatum: sensorDatum
            },
            sensorObj.description,
              sensorDatum,
              sensorDatum,
              sensorDatum,
            ]);

        } catch (e) {
          console.log(e);
        }


      });

      dataTbl.rows().draw();

      let end = new Date().getTime();
      console.log(`Adding data took ${end - start}ms!`);

      if (srcAjax) {
        console.log("Populating type select");
        populateTypeSelect(rawData);
        console.log("Populating type select complete");
      }

      $('#table-live-sensor-data tbody').on('click', 'tr', function () {

        let data = dataTbl.row(this).data();
        $('#table-live-sensor-data tr.selected').removeClass('selected');

        if ($(this).hasClass('selected')) {
          $(this).removeClass('selected');
        } else {
          $(this).addClass('selected');
        }
      });
    }

    function populateTypeSelect(rawData) {

      let typesMap = new Map();

      $(rawData).each((index, sensorDatum) => {

        //this is crappy and repetitve, but oh well
        let sensorTypeMetadata = AAI.getSensorTypeInfo(sensorDatum.type);
        typesMap.set(sensorDatum.type, sensorTypeMetadata);

      });

      //fill out the select
      let typeSelect = $('#type-select');
      typeSelect.empty();

      let allOpt = document.createElement("option");
      allOpt.setAttribute("value", "All Types");
      allOpt.append("All Types");

      typeSelect.append(allOpt);

      //sorted map
      typesMap = new Map([...typesMap.entries()].sort((a, b) => {
        return sortNumericProperty("rank", true)(a[1], b[1]);
      }));

      for (let [key, value] of typesMap.entries()) {

        let opt = document.createElement("option");
        opt.setAttribute("value", key);
        opt.append(value.label + " " + value.units);
        typeSelect.append(opt);

      }
      if (lastSelected) {
        console.log(`Setting last selected to:${lastSelected}`);
        $('#type-select option[value="' + lastSelected + '"]').prop('selected', true);
        $('#type-select').val(lastSelected).change();
      }
    }
  </script>

</html>